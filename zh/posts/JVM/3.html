<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.59" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://lcyp.github.io/blog/zh/blog/zh/posts/JVM/3.html"><meta property="og:site_name" content="𝖑𝖎𝖆𝖓𝖌𝖈𝖍𝖊𝖓𝖞𝖆𝖓𝖌'𝖘 𝖇𝖑𝖔𝖌"><meta property="og:title" content="JVM的内存结构"><meta property="og:description" content="Java虚拟机的内存结构"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-01-02T08:09:55.000Z"><meta property="article:tag" content="内存结构"><meta property="article:published_time" content="2024-11-29T00:00:00.000Z"><meta property="article:modified_time" content="2025-01-02T08:09:55.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"JVM的内存结构","image":[""],"datePublished":"2024-11-29T00:00:00.000Z","dateModified":"2025-01-02T08:09:55.000Z","author":[{"@type":"Person","name":"梁晨阳","url":"https://lcyp.github.io/blog/zh/"}]}</script><link rel="icon" href="/blog/favicon.ico"><title>JVM的内存结构 | 𝖑𝖎𝖆𝖓𝖌𝖈𝖍𝖊𝖓𝖞𝖆𝖓𝖌'𝖘 𝖇𝖑𝖔𝖌</title><meta name="description" content="Java虚拟机的内存结构">
    <link rel="stylesheet" href="/blog/assets/css/styles.31081d02.css">
    <link rel="preload" href="/blog/assets/js/runtime~app.7abee6b2.js" as="script"><link rel="preload" href="/blog/assets/css/styles.31081d02.css" as="style"><link rel="preload" href="/blog/assets/js/229.45e41e1a.js" as="script"><link rel="preload" href="/blog/assets/js/app.66c424c7.js" as="script">
    <link rel="prefetch" href="/blog/assets/js/zh_posts_JVM_2.html.67335826.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_JVM_4.html.8f1b1400.js" as="script"><link rel="prefetch" href="/blog/assets/js/2664.3b1c8d92.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Spring知识_4.html.1eb91bee.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Dubbo_3.html.2fa58cff.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_JVM_1.html.b8ef0f9f.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_JVM_3.html.31e79332.js" as="script"><link rel="prefetch" href="/blog/assets/js/8300.eea3bf10.js" as="script"><link rel="prefetch" href="/blog/assets/js/1798.04ff46ae.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Redis_1.html.9893f197.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Mysql_1.html.154577e9.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Spring知识_2.html.e61ba803.js" as="script"><link rel="prefetch" href="/blog/assets/js/741.281b2516.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_java基础知识_2.html.2bb00c37.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_demo_markdown.html.19272c7f.js" as="script"><link rel="prefetch" href="/blog/assets/js/demo_markdown.html.82cbbc7f.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Redis_Redis.html.6458553a.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_java基础知识_1.html.5bf5bdd9.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_JVM_2.html.b557774b.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Spring知识_1.html.c6268674.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Dubbo_4.html.b118aff0.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_JVM_3.html.f1df9781.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_demo_page.html.c1d90c5c.js" as="script"><link rel="prefetch" href="/blog/assets/js/demo_page.html.80c535f7.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_JVM_5.html.91402030.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_demo_layout.html.35a28fb2.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Dubbo_2.html.a483eafb.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Spring知识_3.html.a5f2603b.js" as="script"><link rel="prefetch" href="/blog/assets/js/demo_layout.html.111c8f6e.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_JVM_1.html.35826626.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_demo_index.html.e643577d.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_tomato.html.6beaa97f.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_banana_2.html.bed6603c.js" as="script"><link rel="prefetch" href="/blog/assets/js/demo_disable.html.d1ff0787.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_apple_2.html.0a8f8116.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_banana_1.html.0c513f3c.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_banana_3.html.47255dfb.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_banana_4.html.744a2bc0.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Dubbo_1.html.5a62fdd3.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_apple_4.html.2b2f6a99.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_apple_3.html.b14dd9b7.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_dragonfruit.html.51f67ebe.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_apple_1.html.c7b3de3d.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_cherry.html.9d00afaf.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_strawberry.html.978709d5.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_JVM_4.html.52945a23.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_demo_disable.html.679f92a8.js" as="script"><link rel="prefetch" href="/blog/assets/js/intro.html.15250283.js" as="script"><link rel="prefetch" href="/blog/assets/js/index.html.5fa7666f.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_index.html.e6352e33.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_intro.html.f86e094d.js" as="script"><link rel="prefetch" href="/blog/assets/js/demo_index.html.53f3516f.js" as="script"><link rel="prefetch" href="/blog/assets/js/demo_encrypt.html.35ae4326.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_demo_encrypt.html.65c4eadc.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_markdown_index.html.db628ecc.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_jvm的生命周期_index.html.959fc58f.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_java基础知识_index.html.6488eb8e.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_index.html.90fe746c.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_程序计数器_index.html.62ee821f.js" as="script"><link rel="prefetch" href="/blog/assets/js/timeline_index.html.97aa791e.js" as="script"><link rel="prefetch" href="/blog/assets/js/article_index.html.f6483d52.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_java基础知识_index.html.55e99ec0.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_使用指南_index.html.ebec1bc1.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_java面试题_index.html.8138353a.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_进程线程_index.html.6bc99fdc.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_使用指南_index.html.64aa3d51.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_内存结构_index.html.d90477e6.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_分布式锁_index.html.5a7af642.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_垃圾回收_index.html.0c6b047d.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_设计模式_index.html.49750854.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_代理模式_index.html.a10102f3.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_类加载器_index.html.c1cccb62.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_页面配置_index.html.e5fd87fa.js" as="script"><link rel="prefetch" href="/blog/assets/js/star_index.html.19215dbb.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_index.html.91d265fd.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_spring知识_index.html.05ab7fca.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_index.html.b9098063.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_类加载_index.html.6932bdce.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_jvm组成_index.html.9163c975.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_dragon-fruit_index.html.79de2270.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Spring知识_index.html.64d2082c.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_jvm组成_index.html.fe4ca7ba.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_strawberry_index.html.86199d9e.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_指南_index.html.16320d26.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_vegetable_index.html.4b493292.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_加密_index.html.19571271.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_反射_index.html.4b1fe060.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_禁用_index.html.161a21f7.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_集合_index.html.7c550af8.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_布局_index.html.1eaccc28.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_page-config_index.html.bcd8f1a9.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_markdown_index.html.c0f14baf.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_banana_index.html.55ae7582.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_cherry_index.html.7228f93b.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_encryption_index.html.afc15a8f.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_fruit_index.html.0ea8be57.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_guide_index.html.3c7102ff.js" as="script"><link rel="prefetch" href="/blog/assets/js/category_apple_index.html.a9d5b820.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_dubbo_index.html.54db536f.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_mysql_index.html.86587a74.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_redis_index.html.c5cfadec.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_index.html.f2e1cc34.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_spring_index.html.64cd7cce.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_dubbo_index.html.894352e9.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_mysql_index.html.465a1554.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_redis_index.html.6c3426fe.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_圆_index.html.58e65937.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_堆_index.html.937c314f.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_栈_index.html.15fe9528.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_红_index.html.48cf8cda.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_jvm_index.html.25fd0d7b.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_大_index.html.643eee86.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_disable_index.html.8c6315e0.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Redis_index.html.9faede2a.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_Mysql_index.html.3f1138ff.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_bean_index.html.7f5a0a94.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_layout_index.html.882c8ed6.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_yellow_index.html.23dc30c8.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_ioc_index.html.af1bac98.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_curly_index.html.f4262dda.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_guide_index.html.0de02422.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_round_index.html.a134782c.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_small_index.html.3be60255.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_面试求职_JVM_index.html.84acbac6.js" as="script"><link rel="prefetch" href="/blog/assets/js/404.html.32e3bbd1.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_long_index.html.2fc442ba.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_big_index.html.a85b353c.js" as="script"><link rel="prefetch" href="/blog/assets/js/tag_red_index.html.554f674d.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_timeline_index.html.7e94fcbb.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_category_index.html.090d8c73.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_article_index.html.125e380d.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_tag_index.html.a0841174.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_star_index.html.c4d93f64.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_banana_index.html.998d7999.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Redis_index.html.67804dd5.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_Dubbo_index.html.316cf7c2.js" as="script"><link rel="prefetch" href="/blog/assets/js/posts_apple_index.html.fac4f1f5.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_JVM_index.html.a5ec2687.js" as="script"><link rel="prefetch" href="/blog/assets/js/zh_posts_index.html.b296c929.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/blog/zh/" aria-label="带我回家"><img class="vp-nav-logo" src="https://sky-take-out-lcy.oss-cn-beijing.aliyuncs.com/unnamed.png" alt><!----><span class="vp-site-name hide-in-pad">𝖑𝖎𝖆𝖓𝖌𝖈𝖍𝖊𝖓𝖞𝖆𝖓𝖌&#39;𝖘 𝖇𝖑𝖔𝖌</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/zh/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/zh/demo/" aria-label="开始"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-heart" style=""></span><!--]-->开始<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://blog.csdn.net/qq_64688685?spm=1011.2124.3001.5343" aria-label="CSDN" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->CSDN<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><div class="vp-nav-item"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" name="i18n" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog/" aria-label="English"><!---->English<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/blog/zh/posts/JVM/3.html" aria-label="简体中文"><!---->简体中文<!----></a></li></ul></button></div></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/lcyp/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/zh/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->主页<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文章</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/blog/icons/dubbo.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="icon" src="/blog/icons/lineicons--vmware.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">JVM</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/zh/posts/JVM/1.html" aria-label="类加载器的核心源码"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->类加载器的核心源码<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/zh/posts/JVM/2.html" aria-label="类加载"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->类加载<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/blog/zh/posts/JVM/3.html" aria-label="JVM的内存结构"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->JVM的内存结构<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/zh/posts/JVM/4.html" aria-label="JVM的垃圾回收"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span><!--]-->JVM的垃圾回收<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/blog/icons/devicon--redis.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/blog/icons/mynaui--face-id.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">面试求职</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/zh/intro.html" aria-label="介绍页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->介绍页<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>JVM的内存结构</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://lcyp.github.io/blog/zh/" target="_blank" rel="noopener noreferrer">梁晨阳</a></span><span property="author" content="梁晨阳"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024年11月29日</span><meta property="datePublished" content="2024-11-29T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 21 分钟</span><meta property="timeRequired" content="PT21M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7 clickable" role="navigation">JVM</span><!--]--><meta property="articleSection" content="JVM"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">内存结构</span><!--]--><meta property="keywords" content="内存结构"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#程序计数器-pc寄存器">程序计数器(PC寄存器)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-在硬件中的作用">1. 在硬件中的作用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-在-java-中的作用">2. 在 Java 中的作用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-jvm-中的程序计数器的特性">3. JVM 中的程序计数器的特性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-在-jvm-栈中的作用">4. 在 JVM 栈中的作用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-程序计数器与其他内存区域的关系">5. 程序计数器与其他内存区域的关系</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-程序计数器的特点">6. 程序计数器的特点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-总结">7. 总结</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#程序计数器在运行中会出现内存溢出吗">程序计数器在运行中会出现内存溢出吗？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#栈">栈</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#局部变量表">局部变量表：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#操作数栈">操作数栈：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#帧数据">帧数据：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#栈内存溢出">栈内存溢出</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#本地方法栈">本地方法栈</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#堆">堆</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#arthas查看堆内存的大小">Arthas查看堆内存的大小：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#设置堆的大小">设置堆的大小：</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#方法区">方法区</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-类的元信息">1，类的元信息：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-运行时常量池">2，运行时常量池：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-字符串常量池">3，字符串常量池：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#intern-方法">intern()方法</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#模拟方法区内存溢出">模拟方法区内存溢出：</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#直接内存">直接内存：</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#主要特点">主要特点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用场景">使用场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#要创建直接内存上的数据-可以使用bytebuffer">要创建直接内存上的数据，可以使用ByteBuffer：</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#如果需要手动调整直接内存的大小-可以使用-xx-maxdirectmemorysize-大小">如果需要手动调整直接内存的大小，可以使用-XX:MaxDirectMemorySize=大小</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><p>Java虚拟机的内存结构</p><!-- more --><h2 id="程序计数器-pc寄存器" tabindex="-1"><a class="header-anchor" href="#程序计数器-pc寄存器"><span>程序计数器(PC寄存器)</span></a></h2><p>程序计数器（ProgramCounterRegister）也叫PC寄存器。</p><p>程序计数器是线程私有的，每个线程一份，每个线程会通过程序计数器记录当前要执行的字节码指令的地址。</p><p>在加载阶段，虚拟机将字节码文件中的指令读取到内存之后，会将原文件中的偏移量转换成内存地址。每一条字节码指令都会拥有一个内存地址。</p><p><img src="/blog/assets/img/image-56.abea25c5.png" alt=" " loading="lazy"><img src="/blog/assets/img/image-57.d828c956.png" alt=" " loading="lazy"></p><ul><li><strong>程序计数器</strong> 作为 JVM 的一个重要组成部分，管理了线程执行过程中各个指令的顺序，确保多线程程序能够正常运行。</li><li>在多线程环境下，它提供了必要的线程间状态隔离，以确保每个线程从其应有的位置继续执行。</li><li>JVM 通过程序计数器、栈帧等数据结构协作，实现了线程控制和方法调用的功能。</li></ul><h3 id="_1-在硬件中的作用" tabindex="-1"><a class="header-anchor" href="#_1-在硬件中的作用"><span>1. <strong>在硬件中的作用</strong></span></a></h3><ul><li><strong>硬件层面</strong>，程序计数器是一个很小的内存区域，它保存着当前正在执行的指令的地址（或偏移量）。CPU 会根据程序计数器中的值来从内存中取指令并执行。每当 CPU 执行完一条指令后，程序计数器会自动更新为下一条指令的地址。</li><li>程序计数器保证了程序在执行过程中能够按照正确的顺序逐条执行指令。</li></ul><h3 id="_2-在-java-中的作用" tabindex="-1"><a class="header-anchor" href="#_2-在-java-中的作用"><span>2. <strong>在 Java 中的作用</strong></span></a></h3><p>在 <strong>Java 虚拟机（JVM）</strong> 中，程序计数器有着不同的作用，具体来说，JVM 中的程序计数器主要用于以下目的：</p><ul><li><strong>线程执行的控制</strong>：每个线程都有独立的程序计数器。Java 中的多线程是通过线程之间的切换来实现的，而每个线程的程序计数器用于记录该线程当前执行到的字节码指令的地址。当线程被调度时，程序计数器帮助虚拟机恢复该线程的执行位置。</li><li><strong>方法调用与返回</strong>：在方法调用过程中，程序计数器指向当前方法的下一条指令。当方法调用结束时，程序计数器将指向调用该方法的位置。</li></ul><h3 id="_3-jvm-中的程序计数器的特性" tabindex="-1"><a class="header-anchor" href="#_3-jvm-中的程序计数器的特性"><span>3. <strong>JVM 中的程序计数器的特性</strong></span></a></h3><ul><li><strong>每个线程都有自己的程序计数器</strong>：JVM 是多线程的，每个线程都有一个独立的程序计数器，这使得线程可以在暂停和恢复时正确执行，不会受到其他线程的影响。</li><li><strong>程序计数器的内容</strong>：对于 <strong>普通方法</strong>，程序计数器保存当前线程正在执行的字节码的<strong>地址</strong>；对于 <strong>native 方法</strong>（由本地方法实现的方法），程序计数器的值为 <code>undefined</code>。</li><li><strong>线程切换时的作用</strong>：程序计数器帮助在多线程切换时保存当前线程的执行位置，确保线程被切换回来时能够从正确的位置继续执行。</li></ul><h3 id="_4-在-jvm-栈中的作用" tabindex="-1"><a class="header-anchor" href="#_4-在-jvm-栈中的作用"><span>4. <strong>在 JVM 栈中的作用</strong></span></a></h3><ul><li>在 JVM 中，程序计数器属于每个线程的私有数据。线程的执行是通过 JVM 栈中的栈帧来管理的，每个栈帧包含了方法的局部变量、操作数栈、常量池引用等内容。程序计数器则与栈帧中的内容一起工作，确保线程能够根据自己的执行路径正确跳转到对应的字节码。</li></ul><h3 id="_5-程序计数器与其他内存区域的关系" tabindex="-1"><a class="header-anchor" href="#_5-程序计数器与其他内存区域的关系"><span>5. <strong>程序计数器与其他内存区域的关系</strong></span></a></h3><ul><li><strong>堆（Heap）</strong>：用于存放对象实例，程序计数器不会直接涉及堆。</li><li><strong>栈（Stack）</strong>：每个线程拥有一个独立的栈，栈中保存了方法调用的上下文（栈帧）。程序计数器通过记录方法调用的下一条指令来帮助线程在栈帧间跳转。</li><li><strong>方法区（Method Area）</strong>：方法区包含了类信息、常量池、静态变量等，程序计数器通过加载字节码的方式与方法区互动。</li></ul><h3 id="_6-程序计数器的特点" tabindex="-1"><a class="header-anchor" href="#_6-程序计数器的特点"><span>6. <strong>程序计数器的特点</strong></span></a></h3><ul><li><strong>小巧且高效</strong>：程序计数器是一块非常小的内存区域（通常只有几字节），它的作用是指示当前指令的地址，因此非常高效。</li><li><strong>独立于线程</strong>：每个线程都有独立的程序计数器，确保线程间不会互相影响。</li></ul><h3 id="_7-总结" tabindex="-1"><a class="header-anchor" href="#_7-总结"><span>7. <strong>总结</strong></span></a></h3><ul><li><strong>程序计数器</strong> 作为 JVM 的一个重要组成部分，管理了线程执行过程中各个指令的顺序，确保多线程程序能够正常运行。</li><li>在多线程环境下，它提供了必要的线程间状态隔离，以确保每个线程从其应有的位置继续执行。</li><li>JVM 通过程序计数器、栈帧等数据结构协作，实现了线程控制和方法调用的功能。</li></ul><h2 id="程序计数器在运行中会出现内存溢出吗" tabindex="-1"><a class="header-anchor" href="#程序计数器在运行中会出现内存溢出吗"><span>程序计数器在运行中会出现内存溢出吗？</span></a></h2><p>内存溢出指的是程序在使用某一块内存区域时，存放的数据需要占用的内存大小超过了虚拟机能提供的内存上限。</p><p><strong>因为每个线程只存储一个固定长度的内存地址，程序计数器是不会发生内存溢出的。</strong></p><p>程序员无需对程序计数器做任何处理</p><h2 id="栈" tabindex="-1"><a class="header-anchor" href="#栈"><span>栈</span></a></h2><p>栈分为两个部分，分别是Java虚拟机栈和本地方法栈。</p><p>Java虚拟机栈用来保存在Java中实现的方法，本地方法栈保存的是Native方法（用C++实现的方法）</p><p>但是HotSpot实现人员发现不管是Java来实现还是C++来实现的方法本质上都是方法，所以在HotSpot中就使用了一个栈来保存这两种方法的信息。</p><p>Java虚拟机栈（JavaVirtualMachineStack）采用栈的数据结构来管理方法调用中的基本数据，先进后出（FILO）,每一个方法的调用都使用一个栈帧（StackFrame）来保存。</p><p>虚拟机栈是每个线程独有的，是每个线程运行时所需要的内存，因此栈内存也是线程安全的。每个栈由多个栈帧frame组成，每个栈帧对应着每次方法调用的时候所占用的内存。正在执行的方法对应的栈帧叫活动栈帧，每个线程只能有一个活动栈帧。当有栈帧来了就会压入栈底，再来就继续压入，方法执行完后就会依次弹栈。<strong>Java虚拟机栈随着线程的创建而创建，而回收则会在线程的销毁时进行。由于方法可能会在不同线程中执行，每个线程都会包含一个自己的虚拟机栈。</strong></p><p>在idea中通过debug调试可以看到每个线程对应的栈的栈帧：</p><figure><img src="/blog/assets/img/image-58.09bce172.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>栈帧的组成：</p><h3 id="局部变量表" tabindex="-1"><a class="header-anchor" href="#局部变量表"><span>局部变量表：</span></a></h3><p>局部变量表的作用是在方法执行过程中存放所有的局部变量。编译成字节码文件时就可以确定局部变量表的内容。</p><p>栈帧中的局部变量表是一个<strong>数组</strong>，数组中每一个位置称之为槽（slot），long和double类型占用两个槽，其它类型占用一个槽。</p><p>通过jclasslib可以看局部变量表的内容：</p><figure><img src="/blog/assets/img/image-59.39f3c795.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>jvm通过局部变量表控制每个局部变量能访问的范围。</p><p>局部变量表除了能够保存<strong>方法体中声明的局部变量（在局部变量表最后边存）</strong>，还能保存<strong>实例方法(没有 <strong>static修饰的方法</strong> )的this对象（保存在0号槽）</strong>，<strong>方法的参数（顺序和方法中定义的顺序一致）</strong>。</p><p>这是一个带有形参的实例方法案例：</p><figure><img src="/blog/assets/img/image-60.7e59e9ba.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>案例：为了节省空间，局部变量表中的槽是可以复用的，一旦某个局部变量不再生效，当前槽就可以再次被使用。</p><figure><img src="/blog/assets/img/image-61.333ac626.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="操作数栈" tabindex="-1"><a class="header-anchor" href="#操作数栈"><span>操作数栈：</span></a></h3><p>操作数栈是栈帧中虚拟机在执行指令过程中用来存放中间数据的一块区域。他是一种栈式的数据结构，如果一条指令将一个值压入操作数栈，则后面的指令可以弹出并使用该值。</p><p>在编译期就可以确定操作数栈的最大深度，从而在执行时正确的分配内存大小。 <img src="/blog/assets/img/image-62.5ebc3942.png" alt=" " loading="lazy"></p><h3 id="帧数据" tabindex="-1"><a class="header-anchor" href="#帧数据"><span>帧数据：</span></a></h3><p>帧数据主要包含动态链接，方法出口，异常表的引用。</p><h4 id="动态链接" tabindex="-1"><a class="header-anchor" href="#动态链接"><span>动态链接：</span></a></h4><p>当前类的字节码指令引用了其它类的属性或方法时，需要将符号引用（编号）转换成对应的运行时常量池中的内存地址。动态链接就保存了编号到运行时常量池的内存地址的映射关系。</p><figure><img src="/blog/assets/img/image-63.5197803a.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>保存的是其它类的属性或方法数据。</p><h4 id="方法出口" tabindex="-1"><a class="header-anchor" href="#方法出口"><span>方法出口：</span></a></h4><p>方法出口指的是方法在正确或者异常结束时，当前栈帧会被弹出，同时程序计数器应该指向上一个栈帧中的下一条指令的地址。所以在当前栈帧中，需要存储此方法出口的地址。</p><p>因此方法出口就是一个地址：上一个栈帧中的下一条指令的地址。</p><h4 id="异常表" tabindex="-1"><a class="header-anchor" href="#异常表"><span>异常表:</span></a></h4><p>异常表存放的是代码中<strong>异常的处理信息</strong>，包含了异常捕获的生效范围以及<strong>异常发生后跳转到的字节码指令位置</strong>。</p><figure><img src="/blog/assets/img/image-64.51c72ea3.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="栈内存溢出" tabindex="-1"><a class="header-anchor" href="#栈内存溢出"><span>栈内存溢出</span></a></h3><p>Java虚拟机栈如果栈帧过多，占用内存超过栈内存可以分配的最大大小就会出现内存溢出。</p><p>Java虚拟机栈内存溢出时会出现StackOverflowError的错误。</p><p>模型：</p><figure><img src="/blog/assets/img/image-65.e67406e3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="设置栈的大小" tabindex="-1"><a class="header-anchor" href="#设置栈的大小"><span>设置栈的大小：</span></a></h4><p>语法：-Xss栈大小</p><p>单位：字节（默认，必须是2024的倍数），k或者K（KB），m或者M（MB），g或者G（GB）</p><p>例：</p><figure><img src="/blog/assets/img/image-66.c977bd3d.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>与-Xss类似，也可以使用-XX:ThreadStackSize调整标志来配置堆栈大小。</p><p>格式为：-XX:ThreadStackSize=1024</p><h4 id="hotspotjvm对栈大小的最大值和最小值有要求" tabindex="-1"><a class="header-anchor" href="#hotspotjvm对栈大小的最大值和最小值有要求"><span>HotSpotJVM对栈大小的最大值和最小值有要求：</span></a></h4><p>比如测试如下两个参数：</p><p>-Xss1k</p><p>-Xss1025m</p><p>Windows(64位)下的jdk8测试最小值为180k,最大值为1024m。</p><figure><img src="/blog/assets/img/image-67.6659dfdc.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="/blog/assets/img/image-68.a8dc5245.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>局部变量过多，操作数栈深度过大也会影响栈内存的大小。</strong></p><p>一般情况下，工作中即便使用了递归进行操作，栈的深度最多也只能到几百，不会出现栈的溢出。所以可以手动指定为-Xss256k节省内存。</p><h3 id="本地方法栈" tabindex="-1"><a class="header-anchor" href="#本地方法栈"><span>本地方法栈</span></a></h3><p>Java虚拟机栈存储了Java方法调用时的栈帧，而本地方法栈存储的是native本地方法的栈帧。</p><p>在Hotspot虚拟机中，<strong>Java虚拟机栈和本地方法栈实现上使用了同一个栈空间。</strong></p><p>本地方法栈会在栈内存上生成一个栈帧，临时保存方法的参数同时方便出现异常时也把本地方法的栈信息打印出来。 <img src="/blog/assets/img/image-69.d70ac988.png" alt=" " loading="lazy"></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            FileOutputStream</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fos</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> FileOutputStream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;O:</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">123.txt&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            fos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FileNotFoundException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IOException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/blog/assets/img/image-70.f5e6a0ac.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="堆" tabindex="-1"><a class="header-anchor" href="#堆"><span>堆</span></a></h2><p>模拟堆内存溢出：</p><p>通过new关键字不停创建对象，放入集合中</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ArrayList</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">objects</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            objects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> in thread </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;main&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> java</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">lang</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">OutOfMemoryError</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Java</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> heap space</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">at </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">org</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">example</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">java</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">13</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到堆内存大小是有上限的，当对象一直向堆中放入对象达到上限之后，就会抛出OutOfMemory错误。</p><h3 id="arthas查看堆内存的大小" tabindex="-1"><a class="header-anchor" href="#arthas查看堆内存的大小"><span>Arthas查看堆内存的大小：</span></a></h3><p>used指的是当前已使用的堆内存，total是jvm已经分配的可以使用的内存，max是jvm可以分配的最大堆内存。</p><p><strong>dashboard -i 刷新频率(毫秒)</strong></p><figure><img src="/blog/assets/img/image-71.95ef6b82.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>memory 命令</strong></p><figure><img src="/blog/assets/img/image-72.46f64b74.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>随着堆中的对象增多，used的空间会变大，total会将自己的空间分配给used,max也会将一部分空间分配给total。</p><p>如果不设置任何的虚拟机参数，max默认是系统内存的1/4,total默认是系统内存的1/64.在实际应用中一般都需要设置total和max的值。</p><h3 id="设置堆的大小" tabindex="-1"><a class="header-anchor" href="#设置堆的大小"><span>设置堆的大小：</span></a></h3><p>要修改堆的大小，可以使用虚拟机参数 -Xmx(max最大值) 和 -Xms(初始的total)</p><p>语法： -Xmx(max最大值) -Xms(初始的total)</p><p>单位：字节（默认，必须是1024的倍数），k或者K（KB），m或者M(MB),g或者G(GB)</p><p>限制：Xmx必须大于2MB，Xms必须大于1MB</p><figure><img src="/blog/assets/img/image-73.9baf0c6e.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>使用Arthas，memory命令查看：</p><figure><img src="/blog/assets/img/image-74.245bf251.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如果显示的堆大小与设置的值不一样，是因为与垃圾回收器有关，计算的是可以分配对象的内存，而不是整个内存。</p><p>Java服务端程序开发时，建议将-Xmx和-Xms设置为相同的值，这样在程序启动之后可以使用的总内存就是最大内存，而无需向Java虚拟机再次申请，减少了申请并分配内存时间上的开销，同时也不会出现内存过剩之后堆收缩的情况。</p><h2 id="方法区" tabindex="-1"><a class="header-anchor" href="#方法区"><span>方法区</span></a></h2><p>方法区是《Java虚拟机规范》中设计的<strong>虚拟概念</strong>，每款jvm在实现上都各不相同，Hotspot设计如下：</p><p>jdk7及之前的版本将方法区存放在<strong>堆区域中的永久代</strong>空间，堆的大小由虚拟机参数来控制。</p><p>jdk7调整永久代大小：-XX:MaxPermSize=值</p><p>jdk8及之后的版本将方法区存放在<strong>元空间</strong>中，元空间位于操作系统维护的<strong>直接内存</strong>中，默认情况下只要不超过操作系统承受的上限，可以一直分配。</p><p>jdk8设置元空间的最大大小：-XX:MaxMetaspaceSize=值</p><p><strong>方法区是存放基础信息的位置，线程共享，主要包含3部分内容：</strong></p><p><strong>类的元信息</strong>：保存了所有类的基本信息</p><p><strong>运行时常量池</strong>：保存了字节码文件中的常量池</p><p><strong>字符串常量池</strong>：保存了字符串常量</p><p><strong>永久代和Java堆的关系：</strong></p><ol><li><strong>逻辑上的分离</strong> ： <ul><li><strong>Java堆</strong> ：是用于存放对象实例的内存区域，包括年轻代和老年代。所有通过 <code>new </code> 关键字创建的对象实例都会被分配在这个区域内。</li><li><strong>永久代</strong> ：是一个独立于Java堆的内存区域，专门用于存储类的元数据（如类结构、方法信息）、运行时常量池以及静态变量等。它有自己的内存管理和垃圾回收机制。</li></ul></li><li><strong>物理位置</strong> ： <ul><li>在某些实现中，永久代和Java堆可能位于同一块连续的物理内存地址范围内，但这并不意味着它们在逻辑上是相同的或可以互换使用。实际上，它们有着不同的用途和管理策略。</li></ul></li><li><strong>内存管理和垃圾回收</strong> ： <ul><li>Java堆和永久代有不同的内存管理和垃圾回收机制。例如，Java堆中的垃圾回收主要关注的是对象的可达性分析，而永久代则有自己特定的垃圾回收算法，比如处理类卸载等。</li></ul></li></ol><p>在JDK 6及之前版本中，虽然永久代和Java堆在物理上可能是相邻或者连续的内存区域，但它们在逻辑上是两个独立的内存区域，各自服务于不同的目的并且具有不同的管理和回收机制。随着JDK版本的发展，永久代的概念逐渐被淘汰，其功能被新的机制所替代。</p><p>jdk6的内存模型图（大致内容）：</p><figure><img src="/blog/assets/img/image-75.75c8e82e.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>jdk7时，有永久代，但是字符串常量池，静态变量从永久代移除，保存到堆中：</p><figure><img src="/blog/assets/img/image-76.8e4f89ee.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>jdk8及以后，没有永久代，被替换成了元空间，存储在了本地内存中：</p><figure><img src="/blog/assets/img/image-77.8803621a.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_1-类的元信息" tabindex="-1"><a class="header-anchor" href="#_1-类的元信息"><span>1，类的元信息：</span></a></h3><p>类加载器在加载完类之后，类加载器的任务就完成了，java虚拟机会将字节码中的信息保存到<strong>方法区中</strong>。生成一个<strong>InstanceKlass对象</strong>（使用C++编写的对象），保存类的所有信息（一般信息，常量池，接口，字段，方法，属性），里边还包含实现特定功能比如多态的信息（虚方法表）。</p><figure><img src="/blog/assets/img/image-78.4565d28b.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>在底层实现上，jvm会把常量池和方法信息筛出来用一块单独的区域存放，而InstanceKlass中只是存放了他们的引用。</p><h3 id="_2-运行时常量池" tabindex="-1"><a class="header-anchor" href="#_2-运行时常量池"><span>2，运行时常量池：</span></a></h3><p>字节码文件通过编号查表的方式找到常量，这种常量池称为静态常量池，比如字节码文件中的常量池。</p><p>当常量池加载到内存中之后，可以通过内存地址快速的定位到常量池中的内容，这种常量池称为运行时常量池。</p><p>在加载阶段，字节码文件中的常量池会被读取到内存中，由原来的静态常量池变成运行时常量池。</p><p>常量由符号引用变为直接引用。</p><h3 id="_3-字符串常量池" tabindex="-1"><a class="header-anchor" href="#_3-字符串常量池"><span>3，字符串常量池：</span></a></h3><p>方法区中除了类的元信息、运行时常量池之外，还有一块区域叫字符串常量池(StringTable)。</p><p>字符串常量池存储代码中定义的常量字符串内容。比如“123” 这个123就会被放入字符串常量池。</p><figure><img src="/blog/assets/img/image-79.b0517afc.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>字符串常量池和运行时常量池有什么关系？</strong></p><p>早期设计时，字符串常量池是属于运行时常量池的一部分，他们存储的位置也是一致的。后续做出了调整， 将字符串常量池和运行时常量池做了拆分。</p><p><strong>存储位置</strong>：</p><ul><li><strong>JDK 6 及之前</strong>：字符串常量池位于方法区（永久代实现）。</li><li><strong>JDK 7</strong>：字符串常量池被移到了堆内存中。</li><li><strong>JDK 8 及之后</strong>：字符串常量池继续位于堆中。</li></ul><p><strong>唯一性</strong>：</p><ul><li>每个字符串字面量在常量池中只存储一个副本。</li><li>如果两个字符串字面量的内容相同，它们会共享常量池中的同一个实例。</li></ul><p><strong>字符串的驻留</strong>：</p><ul><li>字面量字符串会自动存储在常量池中。</li><li>非字面量字符串可以通过调用<code>intern()</code>方法手动将其加入到常量池中。</li></ul><h3 id="intern-方法" tabindex="-1"><a class="header-anchor" href="#intern-方法"><span>intern()方法</span></a></h3><p><strong>定义：</strong></p><p><code>intern() </code> 方法是 <code>java.lang.String </code> 类中的一个方法，用于管理字符串常量池（String Intern Pool）。它的主要作用是确保在Java应用程序中，对于相同内容的字符串只保留一份副本，并返回该副本的引用。具体来说， <code>intern() </code> 方法的行为如下：</p><ol><li><strong>检查字符串常量池</strong> ：当调用 <code>String.intern() </code> 时，JVM会首先检查字符串常量池中是否已经存在一个与调用 <code>intern() </code> 的字符串内容相同的字符串。</li><li><strong>返回现有实例或添加新实例</strong> ： <ul><li>如果存在，则直接返回字符串常量池中已有字符串的引用。</li><li>如果不存在，则将当前字符串添加到字符串常量池中，并返回这个新添加的字符串的引用。</li></ul></li><li><strong>性能和内存优化</strong> ：通过这种方式， <code>intern() </code> 可以减少内存使用，尤其是在程序中有大量重复字符串的情况下。此外，由于比较两个字符串是否相等只需要比较它们的引用，这可以提高字符串比较的速度。</li><li><strong>编译期和运行期的区别</strong> ：需要注意的是，通过双引号定义的字符串字面量（例如 <code>&quot;hello&quot; </code> ）在编译时会被自动加入字符串常量池，而通过 <code>new String(&quot;hello&quot;) </code> 创建的字符串则不会自动进入常量池，除非显式调用了 <code>intern() </code> 方法。</li></ol><p>jdk6版本中intern()方法会把第一次遇到的字符串实例复制到永久代的<strong>字符串常量池</strong>中，返回的也是永久代里面这个字符串实例的引用，jvm启动时就会把”java“加入到常量池中。</p><figure><img src="/blog/assets/img/image-80.a998c66d.png" alt="结果：false,false" tabindex="0" loading="lazy"><figcaption>结果：false,false</figcaption></figure><p>JDK7及之后版本中由于字符串常量池在堆上，所以intern () 方法会把第一次遇到的字符串的引用放入字符串常量池。</p><figure><img src="/blog/assets/img/image-81.7d60d58b.png" alt=" " tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h4><ul><li><strong>性能考虑</strong> ：虽然 <code>intern() </code> 可以节省内存并加速字符串比较，但它也可能会增加垃圾回收的压力，特别是在大量使用 <code>intern() </code> 的情况下。因此，在使用 <code>intern() </code> 时需要权衡利弊。</li><li><strong>版本差异</strong> ：在JDK 6及之前版本中，所有通过 <code>intern() </code> 方法添加到字符串常量池的字符串都被存储在永久代（PermGen）中；从JDK 7开始，字符串常量池被移到了Java堆中，从而减少了对永久代空间的需求，并且允许更灵活地管理这些字符串的生命周期。</li></ul><h3 id="模拟方法区内存溢出" tabindex="-1"><a class="header-anchor" href="#模拟方法区内存溢出"><span>模拟方法区内存溢出：</span></a></h3><p>通过ByteBuddy框架，动态生成字节码数据，加载到内存中。通过死循环不停地加载到方法区，观察方法区是否出现内存溢出的情况：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;net.bytebuddy&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;byte-buddy&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;1.12.23&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Demo1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ClassLoader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Demo1</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Class&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> count;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            ClassWriter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> writer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ClassWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            //第一个参数是Jdk版本，我的是11，显然11时方法区在元空间中，不会发生</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            //但是可以设置方法区的最大内存上线，实现元空间内存溢出</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            writer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">visit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">V11</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Opcodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">ACC_PUBLIC</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,name,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java/lang/Object&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">            byte</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">byteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> writer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toByteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            demo1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">defineClass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name,byteArray,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">byteArray</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(++count);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="直接内存" tabindex="-1"><a class="header-anchor" href="#直接内存"><span>直接内存：</span></a></h2><p>直接内存（Direct Memory）并不在《Java虚拟机规范》中存在，所以并不属于Java运行时的内存区域。</p><p>在 JDK 1.4 中引入了 NIO 机制，使用了直接内存，主要为了解决以下两个问题:</p><p>1，Java堆中的对象如果不再使用要回收，回收时会影响对象的创建和使用。</p><p>2，IO操作比如读文件，需要先把文件读入直接内存（缓冲区）再把数据复制到Java堆中。</p><p>3，在jdk8之后可用来保存方法区中的数据。</p><p>直接内存（Direct Memory）是Java应用程序可以使用的、位于JVM堆外的内存区域。它允许程序直接与操作系统交互，而不经过JVM的垃圾回收机制。直接内存的主要特点和用途如下：</p><h3 id="主要特点" tabindex="-1"><a class="header-anchor" href="#主要特点"><span>主要特点</span></a></h3><ol><li><strong>非堆内存</strong> ： <ul><li>直接内存不属于JVM管理的堆空间，因此它的分配和释放不会影响JVM的垃圾收集器。</li></ul></li><li><strong>高效I/O操作</strong> ： <ul><li>对于某些类型的I/O操作（如文件或网络I/O），使用直接内存在性能上可能更优。因为数据可以直接在本地内存和硬件设备之间传输，减少了数据复制的成本。</li></ul></li><li><strong>减少GC压力</strong> ： <ul><li>由于直接内存不在JVM堆中，大量使用直接内存的对象不会增加GC的负担，从而减少GC暂停时间。</li></ul></li><li><strong>资源管理责任</strong> ： <ul><li>开发者需要手动管理直接内存的生命周期。如果管理不当，可能会导致内存泄漏或其他问题。</li></ul></li><li><strong>不受-Xmx限制</strong> ： <ul><li>直接内存的大小不由JVM堆的最大值（ <code>-Xmx </code> ）控制，而是受限于操作系统的可用内存及配置。</li></ul></li></ol><h3 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景"><span>使用场景</span></a></h3><ul><li><strong>高性能网络编程</strong> ：例如NIO中的 <code>java.nio.ByteBuffer.allocateDirect() </code> 用于创建直接缓冲区。</li><li><strong>大数据处理</strong> ：当处理的数据量非常大时，使用直接内存可以避免JVM堆溢出。</li><li><strong>与本地代码交互</strong> ：通过JNI调用本地代码时，直接内存可以提高效率，因为它不需要在堆和本地内存之间复制数据。</li></ul><h3 id="要创建直接内存上的数据-可以使用bytebuffer" tabindex="-1"><a class="header-anchor" href="#要创建直接内存上的数据-可以使用bytebuffer"><span>要创建直接内存上的数据，可以使用ByteBuffer：</span></a></h3><p>⚫ 语法： ByteBuffer directBuffer = ByteBuffer.allocateDirect(size);</p><p>⚫ 注意事项： arthas的memory命令可以查看直接内存大小，属性名direct。</p><h3 id="如果需要手动调整直接内存的大小-可以使用-xx-maxdirectmemorysize-大小" tabindex="-1"><a class="header-anchor" href="#如果需要手动调整直接内存的大小-可以使用-xx-maxdirectmemorysize-大小"><span>如果需要手动调整直接内存的大小，可以使用-XX:MaxDirectMemorySize=大小</span></a></h3><p>单位k或K表示千字节，m或M表示兆字节，g或G表示千兆字节。默认不设置该参数情况下，JVM 自动选择 最</p><p>大分配的大小。</p><p>以下示例以不同的单位说明如何将 直接内存大小设置为 1024 KB：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">XX</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">MaxDirectMemorySize</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">1m </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">XX</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">MaxDirectMemorySize</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">1024k </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">XX</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">MaxDirectMemorySize</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1048576</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接内存内存溢出会报错：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> in thread </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;main&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> java</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">lang</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">OutOfMemoryError</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Direct</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> buffer memory</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/lcyp/blog/edit/main/src/zh/posts/JVM/3.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/1/2 08:09:55</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 2089117474@qq.com">lcyp</span>,<!--]--><!--[--><span class="vp-meta-info" title="email: 2089117474@qq.com">lcy</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/blog/zh/posts/JVM/2.html" aria-label="类加载"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>类加载</div></a><a class="route-link auto-link next" href="/blog/zh/posts/JVM/4.html" aria-label="JVM的垃圾回收"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">JVM的垃圾回收<span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">   </div><div class="vp-copyright">Copyright © 2025 梁晨阳 </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!----><!--]--><!--]--></div>
    <script src="/blog/assets/js/runtime~app.7abee6b2.js" defer></script><script src="/blog/assets/js/229.45e41e1a.js" defer></script><script src="/blog/assets/js/app.66c424c7.js" defer></script>
  </body>
</html>
